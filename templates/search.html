{% extends "base.html" %} 

{% block title %}{{ translations['title'][current_lang] }}{% endblock %} 

{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Cabecera con logo -->
      <div class="text-center mb-5">
        <img src="{{ url_for('static', filename='icono_titulo.png') }}" 
             alt="Logo" 
             class="mb-3"
             style="width: 100px; height: 100px;">
        <h1 class="display-5 fw-bold">
          {{ translations['title'][current_lang] }}
        </h1>
        <p class="lead text-muted-custom">Buscador inteligente que combina noticias locales con información de DBpedia</p>
      </div>

      <!-- Formulario de búsqueda -->
      <div class="search-form mb-5">
        <form method="POST" class="row g-3">
          <div class="col-md-9">
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-search"></i>
              </span>
              <input type="text" 
                     name="keyword" 
                     placeholder="{{ translations['search_placeholder'][current_lang] }}"
                     value="{{ keyword }}" 
                     class="form-control form-control-lg">
            </div>
            <input type="hidden" name="lang" value="{{ current_lang }}">
          </div>
          <div class="col-md-3">
            <button type="submit" class="btn btn-primary btn-lg w-100">
              <i class="bi bi-search me-2"></i> 
              {{ translations['search_button'][current_lang] }}
            </button>
          </div>
        </form>
        
        <!-- Filtros rápidos -->
        <div class="mt-3">
          <small class="text-muted-custom">Filtrar por tipo:</small>
          <div class="d-flex flex-wrap gap-2 mt-1">
            <a href="{{ url_for('buscar_por_tipo', tipo='Columna', lang=current_lang) }}" 
               class="badge bg-primary text-decoration-none">Columnas</a>
            <a href="{{ url_for('buscar_por_tipo', tipo='Reportaje', lang=current_lang) }}" 
               class="badge bg-success text-decoration-none">Reportajes</a>
            <a href="{{ url_for('buscar_por_tipo', tipo='Noticia', lang=current_lang) }}" 
               class="badge bg-warning text-decoration-none">Noticias</a>
            <a href="{{ url_for('buscar_por_tipo', tipo='Editorial', lang=current_lang) }}" 
               class="badge bg-danger text-decoration-none">Editoriales</a>
          </div>
        </div>
      </div>

      {% if keyword %}
        <!-- Resultados Locales -->
        {% if local_results %}
        <div class="result-section mb-5">
          <h3 class="section-title d-flex align-items-center">
            <i class="bi bi-newspaper me-2"></i> 
            {{ translations['local_results'][current_lang] }}
            <span class="badge bg-primary ms-2">{{ local_results|length }}</span>
          </h3>
          
          <div class="row row-cols-1 g-4">
            {% for item in local_results %}
            <div class="col">
              <div class="card h-100 shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <span class="badge bg-secondary">{{ item.tipo }}</span>
                  <span class="text-muted-custom small">
                    <i class="bi bi-calendar"></i> {{ item.fecha }}
                  </span>
                </div>
                
                <div class="card-body">
                  <h4 class="card-title">
                    <a href="{{ url_for('detalle_noticia', uri=item.uri, lang=current_lang, keyword=keyword) }}"
                       class="text-decoration-none">
                      {{ item.titulo }}
                    </a>
                  </h4>
                  
                  <div class="card-text mb-3">
                    <div class="d-flex flex-wrap gap-3 news-meta">
                      <span>
                        <i class="bi bi-person"></i>
                        <strong>{{ translations['author'][current_lang] }}:</strong>
                        {{ item.autor }}
                      </span>
                      <span>
                        <i class="bi bi-tag"></i>
                        <strong>{{ translations['topic'][current_lang] }}:</strong>
                        {{ item.tematica }}
                      </span>
                      <span>
                        <i class="bi bi-geo-alt"></i>
                        <strong>{{ translations['location'][current_lang] }}:</strong>
                        {{ item.ubicacion }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <div>
                      <span class="badge bg-info">{{ item.enfoque }}</span>
                      <span class="badge bg-light text-dark ms-2">{{ item.idioma }}</span>
                    </div>
                    
                    <div>
                      <a href="{{ url_for('detalle_noticia', uri=item.uri, lang=current_lang, keyword=keyword) }}"
                         class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-info-circle"></i> 
                        {{ translations['view_details'][current_lang] }}
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Resultados DBpedia -->
                <!-- Resultados DBpedia -->
        <div class="result-section">
          <h3 class="section-title d-flex align-items-center">
            <i class="bi bi-globe me-2"></i> 
            {{ translations['dbpedia_results'][current_lang] }}
            <span class="badge bg-success ms-2">{{ dbpedia_results|length }}</span>
          </h3>
          
          {% if dbpedia_results %}
          <div class="row row-cols-1 g-4">
            {% for item in dbpedia_results %}
            <div class="col">
              <div class="card h-100 shadow-sm">
                <div class="card-header bg-info text-white d-flex justify-content-between">
                  <!-- Mostrar solo el nombre del tipo sin el namespace -->
                  {% if item.type %}
                    {% set tipo_parts = item.type.split('#') %}
                    {% if tipo_parts|length > 1 %}
                      <span class="badge bg-light text-dark">{{ tipo_parts[-1] }}</span>
                    {% else %}
                      <span class="badge bg-light text-dark">{{ item.type }}</span>
                    {% endif %}
                  {% else %}
                    <span class="badge bg-light text-dark">Recurso</span>
                  {% endif %}
                  <span class="fw-bold">DBpedia</span>
                </div>
                
                <div class="card-body">
                  <h4 class="card-title">
                    <a href="{{ url_for('detalle_noticia', uri=item.resource.value, lang=current_lang, keyword=keyword) }}"
                       class="text-decoration-none">
                      {{ item.label.value }}
                    </a>
                  </h4>
                  
                  <p class="card-text">{{ item.abstract.value }}</p>
                  
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <div>
                      <span class="text-muted-custom small">
                        <i class="bi bi-database"></i> Fuente: DBpedia
                      </span>
                    </div>
                    
                    <div>
                      <a href="{{ url_for('detalle_noticia', uri=item.resource.value, lang=current_lang, keyword=keyword) }}"
                         class="btn btn-sm btn-outline-info me-2">
                        <i class="bi bi-info-circle"></i> Ver detalles
                      </a>
                      <a href="{{ item.resource.value }}" 
                         target="_blank"
                         class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-box-arrow-up-right"></i> DBpedia.org
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i> 
            {{ translations['no_dbpedida_results'][current_lang] }}
          </div>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}